<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Braze: Build Your Own ML Model</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Braze Brand Fonts & Colors Override */
        :root {
            --braze-orange: #FFA524;
            --braze-pink: #FFA4FB;
            --braze-purple: #801ED7;
            --braze-dark-purple: #300266;
            --braze-light-orange: #FFD4BC;
            --braze-light-pink: #F8D3E8;
            --braze-light-purple: #C9C4EF;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--braze-dark-purple);
            background-color: #f8f9fa;
        }
        .braze-gradient-text {
            background: linear-gradient(90deg, #FFA524, #FFA4FB);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .braze-gradient-bg {
            background: linear-gradient(135deg, #801ED7 0%, #300266 100%);
        }
        select, input {
            border: 2px solid #C9C4EF;
            border-radius: 0.5rem;
            padding: 0.25rem 0.5rem;
            color: #300266;
        }
        select:focus, input:focus {
            outline: none;
            border-color: #801ED7;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- MOCK DATA (Subset of Titanic Data for performance in browser) ---
        // 0 = Died, 1 = Survived
        const TITANIC_DATA = [
            { id: 1, Survived: 0, Pclass: 3, Sex: 'male', Age: 22, SibSp: 1, Fare: 7.25, Embarked: 'S', Group: 'Train' },
            { id: 2, Survived: 1, Pclass: 1, Sex: 'female', Age: 38, SibSp: 1, Fare: 71.28, Embarked: 'C', Group: 'Train' },
            { id: 3, Survived: 1, Pclass: 3, Sex: 'female', Age: 26, SibSp: 0, Fare: 7.92, Embarked: 'S', Group: 'Test' },
            { id: 4, Survived: 1, Pclass: 1, Sex: 'female', Age: 35, SibSp: 1, Fare: 53.1, Embarked: 'S', Group: 'Train' },
            { id: 5, Survived: 0, Pclass: 3, Sex: 'male', Age: 35, SibSp: 0, Fare: 8.05, Embarked: 'S', Group: 'Train' },
            { id: 6, Survived: 0, Pclass: 3, Sex: 'male', Age: 28, SibSp: 0, Fare: 8.45, Embarked: 'Q', Group: 'Test' },
            { id: 7, Survived: 0, Pclass: 1, Sex: 'male', Age: 54, SibSp: 0, Fare: 51.86, Embarked: 'S', Group: 'Train' },
            { id: 8, Survived: 0, Pclass: 3, Sex: 'male', Age: 2, SibSp: 3, Fare: 21.07, Embarked: 'S', Group: 'Train' },
            { id: 9, Survived: 1, Pclass: 3, Sex: 'female', Age: 27, SibSp: 0, Fare: 11.13, Embarked: 'S', Group: 'Train' },
            { id: 10, Survived: 1, Pclass: 2, Sex: 'female', Age: 14, SibSp: 1, Fare: 30.07, Embarked: 'C', Group: 'Test' },
            { id: 11, Survived: 1, Pclass: 3, Sex: 'female', Age: 4, SibSp: 1, Fare: 16.7, Embarked: 'S', Group: 'Train' },
            { id: 12, Survived: 1, Pclass: 1, Sex: 'female', Age: 58, SibSp: 0, Fare: 26.55, Embarked: 'S', Group: 'Train' },
            { id: 13, Survived: 0, Pclass: 3, Sex: 'male', Age: 20, SibSp: 0, Fare: 8.05, Embarked: 'S', Group: 'Test' },
            { id: 14, Survived: 0, Pclass: 3, Sex: 'male', Age: 39, SibSp: 1, Fare: 31.27, Embarked: 'S', Group: 'Train' },
            { id: 15, Survived: 0, Pclass: 3, Sex: 'female', Age: 14, SibSp: 0, Fare: 7.85, Embarked: 'S', Group: 'Test' },
            { id: 16, Survived: 1, Pclass: 2, Sex: 'female', Age: 55, SibSp: 0, Fare: 16.0, Embarked: 'S', Group: 'Train' },
            { id: 17, Survived: 0, Pclass: 3, Sex: 'male', Age: 2, SibSp: 4, Fare: 29.12, Embarked: 'Q', Group: 'Train' },
            { id: 18, Survived: 1, Pclass: 2, Sex: 'male', Age: 30, SibSp: 0, Fare: 13.0, Embarked: 'S', Group: 'Test' },
            { id: 19, Survived: 0, Pclass: 3, Sex: 'female', Age: 31, SibSp: 1, Fare: 18.0, Embarked: 'S', Group: 'Train' },
            { id: 20, Survived: 1, Pclass: 3, Sex: 'female', Age: 15, SibSp: 0, Fare: 7.22, Embarked: 'C', Group: 'Train' },
            { id: 21, Survived: 0, Pclass: 2, Sex: 'male', Age: 35, SibSp: 0, Fare: 26.0, Embarked: 'S', Group: 'Test' },
            { id: 22, Survived: 1, Pclass: 2, Sex: 'male', Age: 34, SibSp: 0, Fare: 13.0, Embarked: 'S', Group: 'Train' },
            { id: 23, Survived: 1, Pclass: 3, Sex: 'female', Age: 15, SibSp: 0, Fare: 8.02, Embarked: 'Q', Group: 'Train' },
            { id: 24, Survived: 1, Pclass: 1, Sex: 'male', Age: 28, SibSp: 0, Fare: 35.5, Embarked: 'S', Group: 'Train' },
            { id: 25, Survived: 0, Pclass: 3, Sex: 'female', Age: 8, SibSp: 3, Fare: 21.07, Embarked: 'S', Group: 'Test' },
            { id: 26, Survived: 1, Pclass: 3, Sex: 'female', Age: 38, SibSp: 1, Fare: 31.38, Embarked: 'S', Group: 'Train' },
            { id: 27, Survived: 0, Pclass: 3, Sex: 'male', Age: 26, SibSp: 0, Fare: 7.22, Embarked: 'C', Group: 'Train' },
            { id: 28, Survived: 0, Pclass: 1, Sex: 'male', Age: 19, SibSp: 3, Fare: 263.0, Embarked: 'S', Group: 'Test' },
            { id: 29, Survived: 1, Pclass: 3, Sex: 'female', Age: 21, SibSp: 0, Fare: 7.75, Embarked: 'Q', Group: 'Train' },
            { id: 30, Survived: 0, Pclass: 3, Sex: 'male', Age: 24, SibSp: 0, Fare: 7.89, Embarked: 'S', Group: 'Train' },
             // ... In a real app we'd load the full CSV. This is a representative sample.
             // Adding some obvious patterns for the "game"
            { id: 31, Survived: 0, Pclass: 3, Sex: 'male', Age: 60, SibSp: 0, Fare: 7.89, Embarked: 'S', Group: 'Train' },
            { id: 32, Survived: 1, Pclass: 1, Sex: 'female', Age: 22, SibSp: 0, Fare: 151, Embarked: 'C', Group: 'Train' },
            { id: 33, Survived: 0, Pclass: 3, Sex: 'male', Age: 42, SibSp: 0, Fare: 7.89, Embarked: 'S', Group: 'Test' },
            { id: 34, Survived: 1, Pclass: 1, Sex: 'female', Age: 45, SibSp: 1, Fare: 80, Embarked: 'S', Group: 'Train' },
        ];
        
        // --- HELPER FUNCTIONS ---

        const getAttributes = () => [
            { key: 'Sex', type: 'categorical', options: ['male', 'female'] },
            { key: 'Age', type: 'numeric', min: 0, max: 100 },
            { key: 'Pclass', type: 'categorical', options: [1, 2, 3] },
            { key: 'Fare', type: 'numeric', min: 0, max: 500 },
            { key: 'SibSp', type: 'numeric', min: 0, max: 8 },
            { key: 'Embarked', type: 'categorical', options: ['S', 'C', 'Q'] }
        ];

        const evaluateCondition = (row, condition) => {
            const val = row[condition.feature];
            if (condition.type === 'categorical') {
                return String(val) === String(condition.value);
            } else {
                const rowVal = parseFloat(val);
                const condVal = parseFloat(condition.value);
                if (condition.operator === '>') return rowVal > condVal;
                if (condition.operator === '<') return rowVal < condVal;
                if (condition.operator === '=') return rowVal === condVal;
                if (condition.operator === '>=') return rowVal >= condVal;
                if (condition.operator === '<=') return rowVal <= condVal;
            }
            return false;
        };

        const predictSingleTree = (row, treeConfig) => {
            // Root
            if (evaluateCondition(row, treeConfig.root)) {
                // Went Left (True)
                if (evaluateCondition(row, treeConfig.leftNode)) {
                    return treeConfig.leftLeafTrue; // 0 or 1
                } else {
                    return treeConfig.leftLeafFalse;
                }
            } else {
                // Went Right (False)
                if (evaluateCondition(row, treeConfig.rightNode)) {
                    return treeConfig.rightLeafTrue;
                } else {
                    return treeConfig.rightLeafFalse;
                }
            }
        };

        const calculateAccuracy = (data, treeConfig) => {
            let correct = 0;
            data.forEach(row => {
                const prediction = predictSingleTree(row, treeConfig);
                if (prediction === row.Survived) correct++;
            });
            return (correct / data.length * 100).toFixed(1);
        };

        // --- COMPONENTS ---

        const Header = ({ activeTab, setActiveTab }) => (
            <div className="braze-gradient-bg text-white shadow-lg">
                <div className="container mx-auto px-6 py-4 flex justify-between items-center">
                    <div className="flex items-center space-x-3">
                        <div className="w-10 h-10 bg-white rounded-lg flex items-center justify-center text-[#801ED7] font-bold text-xl">
                            <i className="fa-solid fa-tree"></i>
                        </div>
                        <div>
                            <h1 className="text-xl font-bold">Braze ML Builder</h1>
                            <p className="text-xs opacity-80">Titanic Survival Prediction</p>
                        </div>
                    </div>
                    <nav className="hidden md:flex space-x-1">
                        {['Intro', 'Tree 1', 'Tree 2', 'Tree 3', 'Ensemble'].map(tab => (
                            <button
                                key={tab}
                                onClick={() => setActiveTab(tab)}
                                className={`px-4 py-2 rounded-lg transition-colors text-sm font-semibold ${
                                    activeTab === tab 
                                    ? 'bg-white text-[#801ED7]' 
                                    : 'text-white hover:bg-white/10'
                                }`}
                            >
                                {tab}
                            </button>
                        ))}
                    </nav>
                </div>
                {/* Mobile Nav */}
                <div className="md:hidden flex overflow-x-auto pb-2 px-2 space-x-2">
                     {['Intro', 'Tree 1', 'Tree 2', 'Tree 3', 'Ensemble'].map(tab => (
                            <button
                                key={tab}
                                onClick={() => setActiveTab(tab)}
                                className={`px-3 py-2 whitespace-nowrap rounded-lg text-xs font-semibold ${
                                    activeTab === tab 
                                    ? 'bg-white text-[#801ED7]' 
                                    : 'text-white hover:bg-white/10'
                                }`}
                            >
                                {tab}
                            </button>
                        ))}
                </div>
            </div>
        );

        const Intro = ({ onStart }) => (
            <div className="max-w-4xl mx-auto mt-10 p-6 bg-white rounded-xl shadow-md">
                <h2 className="text-3xl font-bold text-[#300266] mb-6">Welcome to the ML Builder</h2>
                <div className="space-y-4 text-gray-700">
                    <p className="text-lg">
                        The goal of this simulation is to build a Random Forest model manually. 
                        You will construct <strong>3 distinct decision trees</strong> to predict whether a passenger on the Titanic survived or died.
                    </p>
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6 my-8">
                        <div className="p-4 bg-[#F8D3E8] rounded-lg">
                            <i className="fa-solid fa-code-branch text-[#91186E] text-2xl mb-2"></i>
                            <h3 className="font-bold text-[#91186E]">1. Build Trees</h3>
                            <p className="text-sm">Define splits (e.g., Age > 20) to categorize passengers.</p>
                        </div>
                        <div className="p-4 bg-[#C9C4EF] rounded-lg">
                            <i className="fa-solid fa-chart-line text-[#300266] text-2xl mb-2"></i>
                            <h3 className="font-bold text-[#300266]">2. Check Accuracy</h3>
                            <p className="text-sm">See how your rules perform on Training vs Test data.</p>
                        </div>
                        <div className="p-4 bg-[#FFD4BC] rounded-lg">
                            <i className="fa-solid fa-people-group text-[#E9371F] text-2xl mb-2"></i>
                            <h3 className="font-bold text-[#E9371F]">3. Ensemble</h3>
                            <p className="text-sm">Combine all 3 trees to create a superior "Forest" model.</p>
                        </div>
                    </div>
                    <p>
                        Your mission, should you choose to accept it, is to define these splits to maximize accuracy.
                    </p>
                    <button 
                        onClick={onStart}
                        className="mt-4 bg-[#FFA524] hover:bg-[#E9371F] text-white font-bold py-3 px-8 rounded-lg shadow transition-all transform hover:scale-105"
                    >
                        Start Building Tree 1
                    </button>
                </div>
            </div>
        );

        const NodeConfig = ({ label, config, onChange, isRoot }) => {
            const attributes = getAttributes();
            const selectedAttr = attributes.find(a => a.key === config.feature);

            const handleChange = (field, val) => {
                onChange({ ...config, [field]: val });
            };

            return (
                <div className={`p-4 rounded-lg border-2 ${isRoot ? 'border-[#801ED7] bg-[#F3E5F5]' : 'border-[#FFA524] bg-[#FFF3E0]'} relative`}>
                    <div className={`absolute -top-3 left-4 px-2 text-xs font-bold uppercase tracking-wider ${isRoot ? 'bg-[#801ED7] text-white' : 'bg-[#FFA524] text-white'}`}>
                        {label}
                    </div>
                    
                    <div className="flex flex-col gap-2 mt-2">
                        <div className="flex gap-2">
                            <select 
                                className="w-full text-sm font-semibold"
                                value={config.feature}
                                onChange={(e) => handleChange('feature', e.target.value)}
                            >
                                {attributes.map(attr => <option key={attr.key} value={attr.key}>{attr.key}</option>)}
                            </select>
                            
                            {selectedAttr?.type === 'categorical' ? (
                                <div className="text-sm font-bold flex items-center px-2">=</div>
                            ) : (
                                <select 
                                    className="w-20 text-sm"
                                    value={config.operator}
                                    onChange={(e) => handleChange('operator', e.target.value)}
                                >
                                    <option value=">">&gt;</option>
                                    <option value="<">&lt;</option>
                                    <option value=">=">&ge;</option>
                                    <option value="<=">&le;</option>
                                </select>
                            )}
                        </div>

                        {selectedAttr?.type === 'categorical' ? (
                             <select 
                                className="w-full text-sm"
                                value={config.value}
                                onChange={(e) => handleChange('value', e.target.value)}
                            >
                                {selectedAttr.options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                            </select>
                        ) : (
                            <input 
                                type="number" 
                                className="w-full text-sm"
                                value={config.value}
                                onChange={(e) => handleChange('value', e.target.value)}
                            />
                        )}
                    </div>
                </div>
            );
        };

        const LeafNode = ({ value, onChange }) => (
            <div className="flex flex-col items-center">
                <div className="h-6 w-0.5 bg-gray-300 mb-1"></div>
                <button
                    onClick={() => onChange(value === 1 ? 0 : 1)}
                    className={`px-4 py-2 rounded-full font-bold text-sm shadow transition-colors ${
                        value === 1 
                        ? 'bg-[#10B981] text-white hover:bg-[#059669]' 
                        : 'bg-[#EF4444] text-white hover:bg-[#DC2626]'
                    }`}
                >
                    {value === 1 ? 'Survives' : 'Dies'}
                </button>
            </div>
        );

        const TreeBuilder = ({ treeId, config, setConfig, data }) => {
            const trainData = data.filter(d => d.Group === 'Train');
            const testData = data.filter(d => d.Group === 'Test');

            const trainAcc = calculateAccuracy(trainData, config);
            const testAcc = calculateAccuracy(testData, config);

            // Determine if overfitting (Train much higher than Test)
            const isOverfitting = (parseFloat(trainAcc) - parseFloat(testAcc)) > 15;

            const updateNode = (nodeKey, newConfig) => {
                setConfig(prev => ({ ...prev, [nodeKey]: newConfig }));
            };

            const updateLeaf = (leafKey, newVal) => {
                setConfig(prev => ({ ...prev, [leafKey]: newVal }));
            };

            return (
                <div className="max-w-6xl mx-auto mt-6 px-4">
                    {/* Stats Header */}
                    <div className="bg-white rounded-xl shadow p-4 mb-8 flex flex-col md:flex-row justify-between items-center border-l-4 border-[#801ED7]">
                        <div>
                            <h2 className="text-2xl font-bold text-[#300266]">Decision Tree #{treeId}</h2>
                            <p className="text-sm text-gray-500">Configure nodes to maximize accuracy.</p>
                        </div>
                        <div className="flex gap-6 mt-4 md:mt-0">
                            <div className="text-center">
                                <p className="text-xs uppercase text-gray-400 font-bold">Train Accuracy</p>
                                <p className="text-2xl font-bold text-[#FFA524]">{trainAcc}%</p>
                            </div>
                            <div className="text-center">
                                <p className="text-xs uppercase text-gray-400 font-bold">Test Accuracy</p>
                                <p className={`text-2xl font-bold ${parseFloat(testAcc) > 70 ? 'text-green-500' : 'text-[#801ED7]'}`}>
                                    {testAcc}%
                                </p>
                            </div>
                        </div>
                    </div>

                     {isOverfitting && (
                        <div className="mb-6 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative" role="alert">
                            <strong className="font-bold">Warning: Overfitting!</strong>
                            <span className="block sm:inline"> Your training score is much higher than your test score. Your rules might be too specific.</span>
                        </div>
                    )}

                    {/* Tree Visualizer */}
                    <div className="bg-white/50 backdrop-blur rounded-xl p-8 shadow-inner overflow-x-auto">
                        <div className="flex flex-col items-center min-w-[600px]">
                            
                            {/* Level 1: Root */}
                            <div className="w-64 z-10">
                                <NodeConfig 
                                    label="Root Split" 
                                    isRoot={true}
                                    config={config.root} 
                                    onChange={(c) => updateNode('root', c)} 
                                />
                            </div>

                            {/* Connectors L1 -> L2 */}
                            <div className="flex w-full justify-center h-12 relative">
                                <div className="absolute top-0 bottom-0 border-l-2 border-gray-300 left-1/2"></div>
                                <div className="absolute top-1/2 w-1/2 border-t-2 border-gray-300"></div>
                                <div className="absolute top-1/2 left-[25%] h-1/2 border-l-2 border-gray-300"></div>
                                <div className="absolute top-1/2 right-[25%] h-1/2 border-r-2 border-gray-300"></div>
                                
                                <div className="absolute top-1/2 left-[35%] bg-white px-1 text-xs text-green-600 font-bold">TRUE</div>
                                <div className="absolute top-1/2 right-[35%] bg-white px-1 text-xs text-red-600 font-bold">FALSE</div>
                            </div>

                            {/* Level 2: Branches */}
                            <div className="flex justify-between w-full gap-8">
                                <div className="w-64 flex flex-col items-center">
                                    <NodeConfig 
                                        label="If True..." 
                                        config={config.leftNode} 
                                        onChange={(c) => updateNode('leftNode', c)} 
                                    />
                                    {/* Connectors L2 -> L3 */}
                                    <div className="h-8 w-full relative">
                                        <div className="absolute top-0 h-4 left-1/2 border-l-2 border-gray-300"></div>
                                        <div className="absolute top-4 w-1/2 left-1/4 border-t-2 border-gray-300"></div>
                                        <div className="absolute top-4 h-4 left-1/4 border-l-2 border-gray-300"></div>
                                        <div className="absolute top-4 h-4 right-1/4 border-r-2 border-gray-300"></div>
                                    </div>
                                    <div className="flex justify-between w-full">
                                        <LeafNode value={config.leftLeafTrue} onChange={(v) => updateLeaf('leftLeafTrue', v)} />
                                        <LeafNode value={config.leftLeafFalse} onChange={(v) => updateLeaf('leftLeafFalse', v)} />
                                    </div>
                                </div>

                                <div className="w-64 flex flex-col items-center">
                                    <NodeConfig 
                                        label="If False..." 
                                        config={config.rightNode} 
                                        onChange={(c) => updateNode('rightNode', c)} 
                                    />
                                     {/* Connectors L2 -> L3 */}
                                     <div className="h-8 w-full relative">
                                        <div className="absolute top-0 h-4 left-1/2 border-l-2 border-gray-300"></div>
                                        <div className="absolute top-4 w-1/2 left-1/4 border-t-2 border-gray-300"></div>
                                        <div className="absolute top-4 h-4 left-1/4 border-l-2 border-gray-300"></div>
                                        <div className="absolute top-4 h-4 right-1/4 border-r-2 border-gray-300"></div>
                                    </div>
                                    <div className="flex justify-between w-full">
                                        <LeafNode value={config.rightLeafTrue} onChange={(v) => updateLeaf('rightLeafTrue', v)} />
                                        <LeafNode value={config.rightLeafFalse} onChange={(v) => updateLeaf('rightLeafFalse', v)} />
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            );
        };

        const EnsembleView = ({ configs, data }) => {
            const testData = data.filter(d => d.Group === 'Test');
            
            // Calculate individual stats
            const stats = configs.map((cfg, idx) => {
                let correct = 0;
                testData.forEach(row => {
                    if (predictSingleTree(row, cfg) === row.Survived) correct++;
                });
                return { id: idx + 1, acc: (correct / testData.length * 100).toFixed(1) };
            });

            // Calculate Ensemble Stats (Majority Vote)
            let ensembleCorrect = 0;
            testData.forEach(row => {
                const v1 = predictSingleTree(row, configs[0]);
                const v2 = predictSingleTree(row, configs[1]);
                const v3 = predictSingleTree(row, configs[2]);
                
                const sum = v1 + v2 + v3;
                const prediction = sum >= 2 ? 1 : 0; // Majority vote
                
                if (prediction === row.Survived) ensembleCorrect++;
            });
            const ensembleAcc = (ensembleCorrect / testData.length * 100).toFixed(1);

            return (
                <div className="max-w-4xl mx-auto mt-10 p-6">
                    <h2 className="text-3xl font-bold text-[#300266] mb-8 text-center">Ensemble Results</h2>

                    <div className="grid grid-cols-1 md:grid-cols-4 gap-4 mb-12">
                        {stats.map(s => (
                            <div key={s.id} className="bg-white p-6 rounded-xl shadow text-center border-t-4 border-[#FFA524]">
                                <h3 className="text-gray-500 font-bold uppercase text-xs mb-2">Tree {s.id}</h3>
                                <div className="text-3xl font-bold text-[#300266]">{s.acc}%</div>
                            </div>
                        ))}
                        <div className="bg-[#300266] p-6 rounded-xl shadow text-center border-t-4 border-[#FFA4FB]">
                            <h3 className="text-[#FFA4FB] font-bold uppercase text-xs mb-2">Combined Model</h3>
                            <div className="text-3xl font-bold text-white">{ensembleAcc}%</div>
                        </div>
                    </div>

                    <div className="bg-white p-6 rounded-xl shadow">
                        <h3 className="font-bold text-lg mb-4">Why Ensemble?</h3>
                        <p className="text-gray-600 mb-4">
                            By combining the votes of three different trees, we often achieve higher accuracy than any single tree. 
                            This is the concept behind <strong>Random Forests</strong>.
                        </p>
                        <div className="h-4 w-full bg-gray-200 rounded-full overflow-hidden flex">
                            <div 
                                className="bg-[#FFA524] h-full" 
                                style={{ width: `${stats[0].acc}%`, opacity: 0.5 }} 
                                title="Tree 1"
                            ></div>
                        </div>
                        <div className="mt-2 text-xs text-center text-gray-400">
                             If your Combined Score is lower than your best tree, try to make your trees more different from each other!
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('Intro');
            
            // Default Configs for 3 Trees
            const defaultTree = {
                root: { feature: 'Sex', operator: '=', value: 'male', type: 'categorical' },
                leftNode: { feature: 'Age', operator: '>', value: 10, type: 'numeric' },
                leftLeafTrue: 0,
                leftLeafFalse: 1,
                rightNode: { feature: 'Pclass', operator: '=', value: 3, type: 'categorical' },
                rightLeafTrue: 0,
                rightLeafFalse: 1
            };

            const [tree1, setTree1] = useState({...defaultTree, root: { feature: 'Sex', operator: '=', value: 'male', type: 'categorical' }});
            const [tree2, setTree2] = useState({...defaultTree, root: { feature: 'Fare', operator: '>', value: 20, type: 'numeric' }});
            const [tree3, setTree3] = useState({...defaultTree, root: { feature: 'Pclass', operator: '=', value: 3, type: 'categorical' }});

            return (
                <div className="min-h-screen bg-gray-50 pb-20">
                    <Header activeTab={activeTab} setActiveTab={setActiveTab} />
                    
                    <main>
                        {activeTab === 'Intro' && <Intro onStart={() => setActiveTab('Tree 1')} />}
                        
                        {activeTab === 'Tree 1' && (
                            <TreeBuilder 
                                treeId={1} 
                                config={tree1} 
                                setConfig={setTree1} 
                                data={TITANIC_DATA} 
                            />
                        )}
                        
                        {activeTab === 'Tree 2' && (
                            <TreeBuilder 
                                treeId={2} 
                                config={tree2} 
                                setConfig={setTree2} 
                                data={TITANIC_DATA} 
                            />
                        )}
                        
                        {activeTab === 'Tree 3' && (
                            <TreeBuilder 
                                treeId={3} 
                                config={tree3} 
                                setConfig={setTree3} 
                                data={TITANIC_DATA} 
                            />
                        )}

                        {activeTab === 'Ensemble' && (
                            <EnsembleView 
                                configs={[tree1, tree2, tree3]} 
                                data={TITANIC_DATA} 
                            />
                        )}
                    </main>

                    {activeTab !== 'Intro' && activeTab !== 'Ensemble' && (
                        <div className="fixed bottom-0 left-0 right-0 bg-white border-t p-4 flex justify-between items-center shadow-lg z-50">
                            <div className="text-sm text-gray-500 hidden md:block">
                                Customize the splits above to improve accuracy.
                            </div>
                            <div className="flex gap-2 w-full md:w-auto">
                                <button 
                                    onClick={() => {
                                        const tabs = ['Tree 1', 'Tree 2', 'Tree 3', 'Ensemble'];
                                        const idx = tabs.indexOf(activeTab);
                                        if(idx > 0) setActiveTab(tabs[idx-1]);
                                    }}
                                    className="flex-1 md:flex-none px-4 py-2 border border-gray-300 rounded hover:bg-gray-100"
                                >
                                    Previous
                                </button>
                                <button 
                                    onClick={() => {
                                        const tabs = ['Tree 1', 'Tree 2', 'Tree 3', 'Ensemble'];
                                        const idx = tabs.indexOf(activeTab);
                                        if(idx < tabs.length - 1) setActiveTab(tabs[idx+1]);
                                    }}
                                    className="flex-1 md:flex-none px-6 py-2 bg-[#801ED7] text-white font-bold rounded hover:bg-[#300266]"
                                >
                                    Next Step &rarr;
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
